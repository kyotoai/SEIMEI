{"../miller/2024_11_06_42e8ebfddc819d9dcfb1g.tex": ["% This LaTeX document needs to be compiled with XeLaTeX.\n\\documentclass[10pt]{article}\n\\usepackage[utf8]{inputenc}\n\\usepackage{amsmath}\n\\usepackage{amsfonts}\n\\usepackage{amssymb}\n\\usepackage[version=4]{mhchem}\n\\usepackage{stmaryrd}\n\\usepackage{hyperref}\n\\hypersetup{colorlinks=true, linkcolor=blue, filecolor=magenta, urlcolor=cyan,}\n\\urlstyle{same}\n\\usepackage{graphicx}\n\\usepackage[export]{adjustbox}\n\\graphicspath{ {./images/} }\n\\usepackage[fallback]{xeCJK}\n\\usepackage{polyglossia}\n\\usepackage{fontspec}\n\\setCJKmainfont{Noto Serif CJK TC}\n\n\\setmainlanguage{english}\n\\setmainfont{CMU Serif}\n\n\\title{RESEARCH ARTICLE | APRIL 011998 }\n\n\\author{R. L. Miller, M. S. Chu, J. M. Greene, Y. R. Lin-Liu, and R. E. Waltz\\\\\nGeneral Atomics, San Diego, California 92186-5608}\n\\date{}\n\n\n\\begin{document}\n\\maketitle\n\\section*{Noncircular, finite aspect ratio, local equilibrium model}\n$\\qquad$\\\\\nR. L. Miller; M. S. Chu; J. M. Greene; Y. R. Lin-Liu; R. E. Waltz\n\nCheck for updates\\\\\nPhys. Plasmas 5, 973-978 (1998)\\\\\n\\href{https://doi.org/10.1063/1.872666}{https://doi.org/10.1063/1.872666}\\\\\n\\includegraphics[max width=\\textwidth, center]{2024_11_06_42e8ebfddc819d9dcfb1g-1}\n\n\\section*{Articles You May Be Interested In}\nStability of liquid bridges between an elliptical and a circular supporting disk\\\\\nPhysics of Fluids (October 2003)\\\\\nDirect numerical simulations of two-phase laminar jet flows with different cross-section injection geometries Physics of Fluids (October 2002)\n\nDynamic measurement of optical fiber diameter\\\\\nRev. Sci. Instrum. (December 1973)\n\nPhysics of Plasmas\n\n\\section*{Special Topics Open for Submissions}\n\\section*{Noncircular, finite aspect ratio, local equilibrium model }\n(Received 6 August 1997; accepted 5 January 1998)\n\n\\begin{abstract}\nA tokamak equilibrium model, local to a flux surface, is introduced which is completely described in terms of nine parameters including aspect ratio, elongation, triangularity, and safety factor. By allowing controlled variation of each of these nine parameters, the model is particularly suitable for localized stability studies such as those carried out using the ballooning mode representation of the gyrokinetic equations. \u00a9 1998 American Institute of Physics. [S1070-664X(98)02204-6]\n\\end{abstract}\n\n\\section*{I. INTRODUCTION}\nEquilibrium information used for studying the stability of localized modes in a tokamak typically comes from one of two sources. One is the shifted circle $s-\\alpha$ model $^{1}$ which allows easy manipulation of the shear and pressure gradient but is unable to deal with essential equilibrium features such as elongation and triangularity. The other source is numerically generated equilibria which incorporate all of the correct geometry but require recomputation of an equilibrium when parameters are changed. It can also be difficult to keep some parameters constant while varying others when computing numerical equilibria. One exception is the generalized $s-\\alpha$ model of Greene and Chance ${ }^{2}$ which allows modification of the shear or pressure gradient on a flux surface without recomputing the equilibrium.\n\nHere we utilize the localized equilibrium analysis of Mercier and $\\mathrm{Luc}^{3}$ to develop a local model for finite aspect ratio, noncircular equilibria. The Mercier-Luc analysis has been used by Bishop and co-workers ${ }^{4-6}$ in ballooning mode studies and more recently by Roach et al. ${ }^{7}$ in the calculation of trapped particle precession. We introduce a parametrization technique for the poloidal field which extends the usefulness of this approach.\n\nWe are able to characterize exact local equilibria using nine parameters; s (global magnetic shear), $\\alpha$ (pressure gradient), $A$ (aspect ratio), $\\kappa$ (elongation), $\\delta$ (triangularity), $q$ (safety factor), and the variation of $\\kappa, \\delta$, and the major radius with flux surface. The purpose of developing this model is to facilitate variation of equilibrium parameters in localized stability studies such as those carried out using the ballooning mode representation of the gyrokinetic equations.\n\nIn Sec. II, we review the Mercier-Luc formalism and show the relationship between this analysis and the generalized $s-\\alpha$ model of Greene and Chance ${ }^{2}$ which was developed to study stability to ideal magnetohydrodynamic (MHD) ballooning modes. In Sec. III, we briefly show that the large $A$, shifted circle equilibrium model is a special case of the Mercier-Luc formalism. This has previously been shown by Bishop ${ }^{6}$ but serves as an introduction to our more general model developed in Sec. IV. Section V presents an example application to ideal MHD ballooning modes and Sec. VI contains a discussion and summary.\n\n\\section*{II. MERCIER-LUC FORMALISM}\nThe information required on a flux surface ( $\\psi=\\psi_{0}$ ) to completely specify an equilibrium in the neighborhood of that flux surface was given by Mercier and Luc. ${ }^{3}$ That information consists of (1) the flux surface shape $R_{s}(l), Z_{s}(l)$; (2) the poloidal field on the flux surface $B_{p s}(l)$; and (3) the components of the toroidal current $p^{\\prime}\\left(\\psi_{0}\\right)$ and $f f^{\\prime}\\left(\\psi_{0}\\right)$, where $R$ and $Z$ are the usual cylindrical coordinates and $l$ is the poloidal arc length. Of course, any poloidal coordinate will suffice. The symbol ' denotes a derivative with respect to poloidal flux $\\psi$, and the magnetic field is given by\n\n\n\\begin{equation*}\n\\bar{B}=\\overline{B_{p}}+\\overline{B_{T}}=\\nabla \\phi \\times \\nabla \\psi+f(\\psi) \\nabla \\phi, \\tag{1}\n\\end{equation*}\n\n\nwhere $\\phi$ is the toroidal angle.\\\\\nThe above is necessary and sufficient information to make a local expansion of the Grad-Shafranov equation about the flux surface $\\psi=\\psi_{0}$. One additional piece of information is required to determine the safety factor $q$ and the toroidal field, e.g., $f\\left(\\psi_{0}\\right)=R B_{T}$.\n\nTo perform the local expansion of the Grad-Shafranov equation and determine quantities in the neighborhood of $\\psi_{0}$, Mercier and Luc ${ }^{3}$ define an orthogonal coordinate system $\\rho, l, \\phi$ where $\\rho$ is the normal distance from flux surface $\\psi=\\psi_{0}, l$ is the poloidal distance along the flux surface $\\psi$ $=\\psi_{0}$, and $\\phi$ is the toroidal angle (see Fig. 1).\n\nAdditionally an angle $u$ is defined such that\n\n\n\\begin{equation*}\n\\frac{d R_{s}}{d l}=\\cos u \\tag{2}\n\\end{equation*}\n\n\nand\n\n\n\\begin{equation*}\n\\frac{d Z_{s}}{d l}=-\\sin u \\tag{3}\n\\end{equation*}\n\n\nWith this definition of $u$ we note that\n\n\n\\begin{equation*}\n\\frac{d u}{d l}=-\\frac{1}{R_{c}} \\tag{4}\n\\end{equation*}\n\n\nwhere $R_{c}(l)$ is the radius of curvature of the flux surface $\\psi$ $=\\psi_{0}$ \u3002\n\nIn terms of these coordinates, the cylindrical coordinates $R$ and $Z$ may be written\n\n\n\\begin{equation*}\nR=R(\\rho, l)=R_{s}(l)+\\rho \\sin u(l), \\tag{5}\n\\end{equation*}\n\n\n\\begin{center}\n\\includegraphics[max width=\\textwidth]{2024_11_06_42e8ebfddc819d9dcfb1g-3}\n\\end{center}\n\nFIG. 1. The Mercier-Luc coordinate system.\n\n\n\\begin{equation*}\nZ=Z(\\rho, l)=Z_{s}(l)+\\rho \\cos u(l) \\tag{6}\n\\end{equation*}\n\n\nand the Jacobian is given by\n\n\n\\begin{equation*}\nJ=\\left(1-\\frac{\\rho}{R_{c}}\\right) R \\tag{7}\n\\end{equation*}\n\n\nLet\n\n\n\\begin{equation*}\n\\psi=\\psi_{0}+\\psi_{1}(l) \\rho+\\psi_{2}(l) \\rho^{2}+\\cdots \\tag{8}\n\\end{equation*}\n\n\nTo calculate $B_{p}^{2}$ accurate to $O(\\rho)$ requires only\n\n\n\\begin{equation*}\n\\overline{B_{p}} \\cong \\frac{\\psi_{1}+2 \\rho \\psi_{2}}{R} \\hat{l} \\tag{9}\n\\end{equation*}\n\n\nSo for $\\psi=\\psi_{0}$, i.e., $\\rho=0$ we have\n\n\n\\begin{equation*}\n\\psi_{1}=R_{s}(l) B_{p s}(l) \\tag{10}\n\\end{equation*}\n\n\nand $\\psi_{1}$ is seen to be the gradient of $\\psi$ on the flux surface and completely specified by the original conditions for the local equilibrium.\n\nTo obtain $\\psi_{2}$, start with the Grad-Shafranov equation\n\n\n\\begin{equation*}\n\\Delta^{*} \\psi=R^{2} \\nabla \\cdot\\left(\\frac{\\nabla \\psi}{R^{2}}\\right)=-\\mu_{0} R^{2} p^{\\prime}(\\psi)-f f^{\\prime}(\\psi) \\tag{11}\n\\end{equation*}\n\n\nPlugging in the $\\psi$ expansion of Eq. (8) yields\n\n\n\\begin{align*}\nR^{2} \\nabla \\cdot\\left(\\frac{\\nabla \\psi}{R^{2}}\\right)= & \\frac{R^{2}}{J} \\partial_{l}\\left[\\frac{\\rho \\partial_{l} \\psi_{1}+\\rho^{2} \\partial_{l} \\psi_{2}}{R\\left(1-\\rho / R_{c}\\right)}\\right] \\\\\n& +\\frac{R^{2}}{J} \\partial_{\\rho}\\left[\\frac{\\psi_{1}+2 \\rho \\psi_{2}}{R}\\left(1-\\rho / R_{c}\\right)\\right] \\\\\n= & -\\mu_{0} R^{2} p^{\\prime}(\\psi)-f f^{\\prime}(\\psi) \\tag{12}\n\\end{align*}\n\n\nWe just need the leading order term (independent of $\\rho$ ) here which comes from the $\\rho$ derivative above and using Eq. (10) to eliminate $\\psi_{1}$ we have\n\n\n\\begin{equation*}\n\\psi_{2}=\\frac{1}{2}\\left[\\left(\\sin u+\\frac{R_{s}}{R_{c}}\\right) B_{p s}-\\mu_{0} R_{s}^{2} p^{\\prime}\\left(\\psi_{0}\\right)-f f^{\\prime}\\left(\\psi_{0}\\right)\\right] \\tag{13}\n\\end{equation*}\n\n\nIt is now possible to give expressions for the poloidal and toroidal fields correct to $O(\\rho)$ (Refs. 2, 3)\n\n\n\\begin{equation*}\nB_{p}^{2}=B_{p s}^{2}\\left[1+2 \\rho\\left(\\frac{1}{R_{c}}-\\frac{\\mu_{0} R_{s} p^{\\prime}\\left(\\psi_{0}\\right)}{B_{p s}}-\\frac{f f^{\\prime}\\left(\\psi_{0}\\right)}{R_{s} B_{p s}}\\right)\\right], \\tag{14}\n\\end{equation*}\n\n\nand\n\n\n\\begin{equation*}\nB_{\\phi}^{2}=\\frac{f^{2}\\left(\\psi_{0}\\right)}{R_{s}^{2}}\\left[1+\\frac{2 \\rho}{R_{s}}\\left(-\\sin u+\\frac{f^{\\prime}\\left(\\psi_{0}\\right)}{f\\left(\\psi_{0}\\right)} R_{s}^{2} B_{p s}\\right)\\right] \\tag{15}\n\\end{equation*}\n\n\nThe Mercier-Luc formulas for localized equilibria used here have a simple connection to the generalized $s-\\alpha$ analysis developed by Greene and Chance ${ }^{2}$ to study ideal MHD ballooning modes. We start with the formula for the safety factor $q$ given by\n\n\n\\begin{equation*}\nq=\\frac{f}{2 \\pi} \\int \\frac{d l_{p}}{R^{2} B_{p}} \\tag{16}\n\\end{equation*}\n\n\nwhere $d l_{p}$ is the differential poloidal length on a flux surface and equal to $d l$ for the surface $\\psi=\\psi_{0}$. By evaluating Eq. (16) for $\\rho \\neq 0$ using the expansions above we can calculate $\\partial q / \\partial \\psi$. The following formulas are derived from Eqs. (2)(7), (10), and (13) through Eq. (15),\n\n\n\\begin{align*}\n& d l_{p}=\\left(1-\\rho / R_{c}\\right) d l  \\tag{17}\\\\\n& R^{-2}=R_{s}^{-2}\\left(1-\\frac{2 \\rho}{R_{s}} \\sin u\\right)  \\tag{18}\\\\\n& B_{p}^{-1}=B_{p s}^{-1}\\left[1-\\rho\\left(\\frac{1}{R_{c}}-\\frac{\\mu_{0} R_{s} p^{\\prime}\\left(\\psi_{0}\\right)}{B_{p s}}-\\frac{f f^{\\prime}\\left(\\psi_{0}\\right.}{R_{s} B_{p s}}\\right)\\right] \\tag{19}\n\\end{align*}\n\n\nand\n\n\n\\begin{equation*}\n\\rho=\\frac{\\psi-\\psi_{0}}{\\psi_{1}}=\\frac{\\psi-\\psi_{0}}{R_{s} B_{p s}} \\tag{20}\n\\end{equation*}\n\n\nUsing Eqs. (17)-(20) we find\n\n\n\\begin{align*}\n\\frac{\\partial q}{\\partial \\psi}= & \\frac{f^{\\prime}\\left(\\psi_{0}\\right)}{f\\left(\\psi_{0}\\right)} q+\\frac{f\\left(\\psi_{0}\\right)}{2 \\pi} \\int \\frac{d l}{R_{s}^{3} B_{p s}^{2}}\\left[-\\frac{2}{R_{c}}-\\frac{2 \\sin u}{R_{s}}\\right. \\\\\n& \\left.+\\frac{\\mu_{0} p^{\\prime} R_{s}\\left(\\psi_{0}\\right)}{B_{p s}}+\\frac{f f^{\\prime}\\left(\\psi_{0}\\right)}{R_{s} B_{p s}}\\right] \\tag{21}\n\\end{align*}\n\n\nThis last expression shows that $s$ and $\\alpha\\left(q^{\\prime}\\right.$ and $\\left.p^{\\prime}\\right)$ can be modified by just changing $p^{\\prime}$ and $f f^{\\prime}$, without changing the shape or the magnetic field of local equilibrium. This is exactly what the Greene and Chance analysis does and the formulas for $\\partial q / \\partial \\psi$, etc., are in fact identical in the two approaches.\n\nFinally, although we do not consider rotation elsewhere in this paper, we note that it is a simple matter to extend the above analysis to include equilibria with toroidal velocity, $v=R \\Omega(\\psi) \\hat{\\phi}$. The equilibrium equation is then given by ${ }^{8}$\n\n\n\\begin{equation*}\n\\Delta^{*} \\psi=R^{2} \\nabla \\cdot\\left(\\frac{\\nabla \\psi}{R^{2}}\\right)=-\\mu_{0} R^{2} \\frac{\\partial p(\\psi, R)}{\\partial \\psi}-f f^{\\prime}(\\psi) \\tag{22}\n\\end{equation*}\n\n\nThe only change from Eq. (11) is that the pressure is no longer a flux function-due to centrifugal effects-and is instead given by\n\n\n\\begin{equation*}\np(\\psi, R)=p_{0}(\\psi) e^{m R^{2} \\Omega(\\psi)^{2} / 2 T(\\psi)} \\tag{23}\n\\end{equation*}\n\n\nwhere the mass $m$ and temperature $T(\\psi)$ have entered via the ratio of pressure to mass density $p(\\psi, R) / \\rho(\\psi, R)$ $=T(\\psi) / \\mathrm{m}$. We can include toroidal rotation in the local equilibrium above by making the substitution\n\n\n\\begin{align*}\np^{\\prime}(\\psi) \\rightarrow & \\left\\{p_{0}^{\\prime}(\\psi)+R^{2} p_{0}(\\psi)\\right. \\\\\n& \\left.\\times\\left[\\frac{m \\Omega^{2}(\\psi)}{2 T(\\psi)}\\right]^{\\prime}\\right\\} e^{m R^{2} \\Omega^{2}(\\psi) / 2 T(\\psi)}, \\tag{24}\n\\end{align*}\n\n\nin Eqs. (13), (14), (19), and (21). Rotation thus requires four numbers to replace $p^{\\prime}\\left(\\psi_{0}\\right)$, namely, $p_{0}\\left(\\psi_{0}\\right), \\quad p_{0}^{\\prime}\\left(\\psi_{0}\\right)$, $\\left[m \\Omega^{2}\\left(\\psi_{0}\\right) / 2 T\\left(\\psi_{0}\\right)\\right.$,] and $\\left[m \\Omega^{2}\\left(\\psi_{0}\\right) / 2 T\\left(\\psi_{0}\\right)\\right]^{\\prime}$. Of course, stability analyses will also require $\\Omega, \\Omega^{\\prime}, T$, and $T^{\\prime}$ be separately specified. ${ }^{9}$\n\n\\section*{III. LARGE $A$, SHIFTED CIRCLE MODEL}\nIn this section we show that the shifted circle model ${ }^{1,6}$ is a special case of the local equilibrium expansion described in the last section. The shifted circle model geometry is usually written as\n\n\n\\begin{align*}\n& R=\\left[R_{0}+\\Delta(r)\\right]+r \\cos \\theta, \\\\\n& Z=r \\sin \\theta . \\tag{25}\n\\end{align*}\n\n\nIt is important to realize that the above equilibrium specification is quite different from the local equilibrium approach described in the previous section. Equation (25) is global in that it specifies the flux surface shape on EVERY flux surface. In general, such an ad hoc specification of every flux surface is not an equilibrium because it will not satisfy the Grad-Shafranov equation. The shifted circle model is self-consistent only at low $\\beta_{p}$ and large $A$ (Ref. 10) and we demonstrate this below.\n\nEquation (25) determines the variation of $B_{p}$ on a flux surface, as well as shape, since ALL surfaces are specified. Note $\\psi=\\psi(r)$. We can readily calculate from Eq. (25),\n\n\n\\begin{equation*}\nB_{p}=|\\nabla \\phi \\times \\nabla \\psi|=\\frac{\\partial_{r} \\psi}{R}|\\nabla r|=\\frac{\\partial_{r} \\psi}{R\\left(1+\\partial_{r} \\Delta \\cos \\theta\\right)} \\tag{26}\n\\end{equation*}\n\n\nPutting Eqs. (25) and (26) in the Grad-Shafranov equation, the formula for the Shafranov shift emerges ${ }^{11}$\n\n\n\\begin{equation*}\n\\partial_{r} \\Delta=-\\frac{r}{R_{0}}\\left(\\beta_{p}+\\frac{l_{i}}{2}\\right) . \\tag{27}\n\\end{equation*}\n\n\n$B_{p}$ on the reference surface is given in the Mercier-Luc approach and is thus constrained to agree with Eq. (26). To make a meaningful comparison we look at a nearby flux surface with $\\psi=\\psi_{0}+\\delta \\psi$. We expand $B_{p}$ in Eq. (26) to first order in $\\delta r$, where $\\delta \\psi=\\delta r \\partial_{r} \\psi$ and obtain\n\n\n\\begin{align*}\nB_{p s c}= & B_{p s}\\left\\{1+\\frac{\\delta \\psi}{R B_{p s}\\left(1+\\partial_{r} \\Delta \\cos \\theta\\right)}\\left[-\\frac{\\cos \\theta+\\partial_{r} \\Delta}{R}\\right.\\right. \\\\\n& \\left.\\left.-\\frac{\\partial_{r r} \\Delta \\cos \\theta}{\\left(1+\\partial_{r} \\Delta \\cos \\theta\\right)}+\\frac{\\partial_{r r} \\psi}{\\partial_{r} \\psi}\\right]\\right\\} \\tag{28}\n\\end{align*}\n\n\nwhere the subscript sc refers to shifted circle. To facilitate the comparison with Eq. (14) we eliminate $\\cos \\theta$ in favor of $R$ and $B_{p}$ using Eqs. (25) and (26),\n\n\n\\begin{align*}\nB_{p s c}= & B_{p s}\\left\\{1+\\frac{\\delta \\psi}{R_{s} B_{p s}}\\left[-\\frac{1}{R_{s} \\partial_{r} \\Delta}+\\frac{B_{p s}}{\\partial_{r} \\psi}\\left(\\frac{1}{\\partial_{r} \\Delta}-\\partial_{r} \\Delta\\right)\\right.\\right. \\\\\n& \\left.\\left.+\\frac{R_{s} B_{p s}}{\\partial_{r} \\psi}\\left(\\frac{\\partial_{r r} \\psi}{\\partial_{r} \\psi}-\\frac{\\partial_{r r} \\Delta}{\\partial_{r} \\Delta}\\right)+\\left(\\frac{R_{s} B_{p s}}{\\partial_{r} \\psi}\\right)^{2} \\frac{\\partial_{r r} \\Delta}{\\partial_{r} \\Delta}\\right]\\right\\} . \\tag{29}\n\\end{align*}\n\n\nBy contrast, for the localized equilibrium approach of the last section we start with Eq. (25) giving the flux surface shape for $r=r_{0}$ only, and Eq. (26) giving the poloidal field for $r=r_{0}$ only. Then using the expansion in $\\rho$ given by Eq. (14), for flux surface $\\psi=\\psi_{0}+\\delta \\psi$ we have\n\n\n\\begin{align*}\nB_{p \\mathrm{ml}}= & B_{p s}\\left[1+\\frac{\\delta \\psi}{R_{s} B_{p s}}\\left(-\\frac{1}{r_{0}}-\\frac{\\mu_{0} R_{s} p^{\\prime}\\left(\\psi_{0}\\right)}{B_{p s}}\\right.\\right. \\\\\n& \\left.\\left.-\\frac{f f^{\\prime}\\left(\\psi_{0}\\right)}{R_{s} B_{p s}}\\right)\\right] \\tag{30}\n\\end{align*}\n\n\nwhere the subscript ml refers to Mercier-Luc. A comparison of Eqs. (29) and (30) shows that they are quite different functions of $R$ and $B_{p}$. They do, however, agree at large $R / r=\\epsilon^{-1}$ assuming that $p^{\\prime}$ is $O(1)$. Performing the $\\epsilon$ expansion and setting $B_{p \\mathrm{ml}}=B_{p \\mathrm{sc}}$, the terms of $O(1)$ yield\n\n\n\\begin{equation*}\nr^{-1} \\partial_{r}\\left(r \\partial_{r} \\psi\\right)=-\\mu_{0} R_{0}^{2} p^{\\prime}-f f^{\\prime} \\tag{31}\n\\end{equation*}\n\n\nand the terms of $O(\\epsilon \\cos \\theta)$ yield\n\n\n\\begin{equation*}\n\\partial_{r}\\left[r\\left(\\partial_{r} \\psi\\right)^{2} \\partial_{r} \\Delta\\right]=2 \\mu_{0} r^{2} R_{0} \\partial_{r} p-\\frac{r}{R_{0}}\\left(\\partial_{r} \\psi\\right)^{2} \\tag{32}\n\\end{equation*}\n\n\nwhich integrates to the Shafranov shift equation given by Eq. (27). The shifted circle is a special case of the Mercier-Luc analysis. ${ }^{6}$\n\nAlternatively, if we assume large $\\beta_{p} \\sim 1 / \\epsilon$, then $p^{\\prime}$ is $O(1 / \\epsilon)$. This requires that $f f^{\\prime} \\sim 1 / \\epsilon$ and that the combination $-\\mu_{0} R_{0}^{2} p^{\\prime}-f f^{\\prime}$ is $O(1)$, however, there is now another $O(1)$ pressure term and Eq. (31) becomes\n\n\n\\begin{align*}\nr^{-1} \\partial_{r}\\left(r \\partial_{r} \\psi\\right)= & -\\mu_{0} R_{0}^{2} p^{\\prime}-f f^{\\prime}-2 \\mu_{0} R_{0} \\Delta(r) p^{\\prime} \\\\\n& -2 \\mu_{0} R_{0}^{2} \\epsilon p^{\\prime} \\cos \\theta \\tag{33}\n\\end{align*}\n\n\nThe $\\theta$ dependence of the last term on the right-hand side shows that this equation cannot be satisfied because all of the other quantities are independent of $\\theta$. In other words, the shifted circle equilibrium is not valid for large $\\beta_{p}$; one flux surface can be a circle, but nearby flux surfaces will be noncircular. The next section shows how the restrictions of large $A$, circularity, and small $\\epsilon \\beta_{p}$ can all be overcome with the generalized model.\n\n\\section*{IV. FINITE A, NONCIRCULAR MODEL}\nWe now introduce a model appropriate for finite aspect ratio and noncircular cross section, and a parametrization of localized equilibrium for arbitrary $\\kappa, \\delta$, and $A$.\n\nTo specify the shape we use a standard formula for Deeshaped plasmas, ${ }^{12}$\n\n\n\\begin{align*}\n& R_{s}=R_{0}+r \\cos \\left[\\theta+\\left(\\sin ^{-1} \\delta\\right) \\sin \\theta\\right] \\\\\n& Z_{s}=\\kappa r \\sin \\theta \\tag{34}\n\\end{align*}\n\n\nwith $A=R_{0} / r$. The real problem is how to parametrize $B_{p}(\\theta)$. To do this we assume, analogous to the shifted circle model, that nearby flux surfaces are given by the same formula as Eq. (34) with modified $R_{0}, \\kappa$, and $\\delta$, i.e., assume\n\n\n\\begin{align*}\n& R_{s r}=R_{0}(r)+r \\cos \\left\\{\\theta+\\left[\\sin ^{-1} \\delta(r)\\right] \\sin \\theta\\right\\}  \\tag{35}\\\\\n& Z_{s r}=\\kappa(r) r \\sin \\theta\n\\end{align*}\n\n\nNote that $r$, the minor radius, is a flux function. Then $B_{p}$ can be calculated as in Eq. (26),\n\n\n\\begin{equation*}\nB_{p}=|\\nabla \\phi \\times \\nabla \\psi|=\\frac{\\partial_{r} \\psi}{R}|\\nabla r|, \\tag{36}\n\\end{equation*}\n\n\nand $\\nabla r$ can be calculated from $R_{s r}$ and $Z_{s r}$ in Eq. (35) yielding after some algebra\n\n\n\\begin{equation*}\nB_{p}=\\frac{\\partial_{r} \\psi \\kappa^{-1} R^{-1}\\left[\\sin ^{2}(\\theta+x \\sin \\theta)(1+x \\cos \\theta)^{2}+\\kappa^{2} \\cos ^{2} \\theta\\right]^{1 / 2}}{\\cos (x \\sin \\theta)+\\partial_{r} R_{0} \\cos \\theta+\\left[s_{\\kappa}-s_{\\delta} \\cos \\theta+\\left(1+s_{\\kappa}\\right) x \\cos \\theta\\right] \\sin \\theta \\sin (\\theta+x \\sin \\theta)}, \\tag{37}\n\\end{equation*}\n\n\nwhere\n\n\n\\begin{align*}\n& \\sin x=\\delta  \\tag{38}\\\\\n& s_{\\kappa}=\\frac{r \\partial_{r} \\kappa}{\\kappa} \\tag{39}\n\\end{align*}\n\n\nand\n\n\n\\begin{equation*}\ns_{\\delta}=\\frac{r \\partial_{r} \\delta}{\\sqrt{1-\\delta^{2}}} \\tag{40}\n\\end{equation*}\n\n\nWe want to emphasize that the shape assumption made in Eq. (35) for nearby flux surfaces is merely a device for constructing the poloidal magnetic field given by Eq. (37). Once Eq. (37) is obtained we discard the information in Eq. (35) so in contrast to the shifted circle model of the previous section, there is no question concerning whether the GradShafranov equation is locally satisfied. It is. If we chose to do so we could construct nearby flux surfaces, using Eq. (14), which in general will approximate Eq. (35) but not be exactly the same. The difference is the difference required to assure that the Grad-Shafranov equation is locally satisfied.\n\nIn accordance with the Mercier-Luc prescription given in Sec. I, our complete local model is given by Eq. (34) for the shape of the surface, Eq. (37) for the poloidal field on the surface, and the components of the toroidal current $p^{\\prime}\\left(\\psi_{0}\\right)$ and $f f^{\\prime}\\left(\\psi_{0}\\right)$. In total, our localized model requires nine parameters plus two normalization constants. The shape requires three parameters, $A, \\kappa$, and $\\delta$. The poloidal field requires four additional parameters, $s_{\\kappa}, s_{\\delta}, \\partial_{r} R_{0}$, and $q$. (We choose to specify the safety factor $q$ instead of $\\partial_{r} \\psi$.) Finally we need to specify $p^{\\prime}\\left(\\psi_{0}\\right)$ and $f f^{\\prime}\\left(\\psi_{0}\\right)$ which we do via the dimensionless quantities, $s$ and $\\alpha$, where ${ }^{13}$\n\n\n\\begin{align*}\n& s \\equiv \\frac{2 V \\partial_{\\psi} q}{\\partial_{\\psi} V}  \\tag{41}\\\\\n& \\alpha \\equiv-\\frac{2 \\partial_{\\psi} V}{(2 \\pi)^{2}}\\left(\\frac{V}{2 \\pi^{2} R_{0}}\\right)^{1 / 2} \\mu_{0} p^{\\prime} \\tag{42}\n\\end{align*}\n\n\nand $V$ is the volume enclosed by the flux surface.\\\\\nThe above nine parameters are dimensionless. We can establish physical units by specifying the minor radius $r$, and\\\\\nthe toroidal field $B_{0}=f_{0} / R_{0}$. The $B_{0}$ value will determine $\\partial_{r} \\psi$ in Eq. (37) through the safety factor relation given by Eq. (16).\n\nProbably the least familiar or intuitive parameters in the above set are $S_{\\kappa}, S_{\\delta}$, and $\\partial_{r} R_{0}$; this can present some difficulty in deciding what values to assign these parameters. Experience with numerically generated equilibria has shown that $S_{\\kappa}$ is typically quite small and positive, that is $\\partial_{r} \\kappa$ $<\\kappa / r$. The triangularity $\\delta$ is defined as $\\left[R_{0}-R_{\\max (z)}\\right] / r$. [This can be verified by Eq. (34).] $R_{\\max (z)}$ is defined as the $R$ value on the flux surface where the maximum $Z$ occurs. This definition of triangularity goes to zero at the magnetic axis where flux surfaces become elliptical. Again, experience with numerical equilibria shows that as a rough approximation $\\delta \\propto r$ and therefore a reasonable value for $S_{\\delta}$ is $\\delta /(1$ $\\left.-\\delta^{2}\\right)^{1 / 2}$. Finally, the parameter $\\partial_{r} R_{0}$, is related to $\\beta_{p}$ and $l_{i}$ as Eq. (27) shows for the shifted circle model. Lao et al. ${ }^{14}$ have derived a large $A$, elliptical generalization of this result\n\n\n\\begin{equation*}\n\\partial_{r} R_{0}=-\\frac{r}{R_{0}}\\left[\\frac{2\\left(\\kappa^{2}+1\\right)}{3 \\kappa^{2}+1}\\left(\\beta_{p}+\\frac{l_{i}}{2}\\right)+\\frac{1}{2} \\frac{\\kappa^{2}-1}{3 \\kappa^{2}+1}\\right], \\tag{43}\n\\end{equation*}\n\n\nwhere\n\n\n\\begin{align*}\n& \\beta_{p}=\\frac{2 \\mu_{0}\\left[\\langle p\\rangle_{v}-p(r)\\right]}{\\overline{B_{p}^{2}}}  \\tag{44}\\\\\n& l_{i}=\\frac{1}{2} \\frac{\\left\\langle B_{p}^{2}\\right\\rangle_{v}}{\\overline{B_{p}^{2}}} \\tag{45}\n\\end{align*}\n\n\nand\n\n\n\\begin{equation*}\n\\overline{B_{p}}=\\frac{\\mu_{0} I(r)}{L_{p}(r)} \\tag{46}\n\\end{equation*}\n\n\nwhere $\\left\\rangle_{v}\\right.$ is a volume average and $L_{p}(r)$ is the poloidal circumference.\n\nIn comparing with numerical equilibria at finite $A$ and $\\delta>0$, we find the above formula tends to overweight $l_{i}$ but the formula is fairly accurate, to within $20 \\%-30 \\%$, down to $A \\sim 3$. It should be possible to generate a large number of numerical equilibria with a range of $A, \\kappa, \\delta, \\beta_{p}$, and $l_{i}$ and by fitting these data obtain an improved expression for $\\partial_{r} R_{0}$\\\\\n\\includegraphics[max width=\\textwidth, center]{2024_11_06_42e8ebfddc819d9dcfb1g-6(2)}\n\nFIG. 2. Comparison of flux surface shape from numerical equilibrium at $\\widetilde{\\psi}=0.77$ to the flux surface from Eq. (34) using the parameters $A, \\kappa$, and $\\delta$ obtained from numerical equilibrium. The outer boundary is the fixed boundary of the numerical equilibrium.\\\\\nover that given by Eq. (43). Such data could also be used to obtain expressions for $S_{\\kappa}$ and $S_{\\delta}$. We have not attempted to do this.\n\nNext we look at how well a parametrized shape and $B_{p}$ compare with a numerically generated equilibrium. We generated a numerical equilibrium using the fixed boundary code TOQ (Ref. 14) by specifying the outer boundary using Eq. (34) with $\\kappa=2, \\delta=0.7, R_{0}=1.7$, and $r=0.65$. The pressure gradient profile is given as $p^{\\prime}=C(1-\\widetilde{\\psi})$ with $C$ adjusted to give $\\beta_{\\text {axis }}=20 \\%$. Finally, the safety factor profile is specified as $q=1.1+4 \\widetilde{\\psi}{ }^{3}$, where $\\widetilde{\\psi}$ is the normalized poloidal flux ranging from 0 on axis to 1 at the edge. Data from the numerical equilibrium were then used to calculate the required nine parameters on a range of flux surfaces. For the flux surface $\\widetilde{\\psi}=0.77$, they are $A=3.17, \\kappa=1.66, \\delta=0.416$, $s_{\\kappa}=0.70, s_{\\delta}=1.37, \\partial_{r} R_{0}=-0.354, q=3.03, s=2.47$, and $\\alpha=1.22$. Figure 2 shows a comparison of the actual flux surface shape at $\\widetilde{\\psi}=0.77$ compared to the flux surface derived from the parameters $A, \\kappa$, and $\\delta$. They are seen to lie on top of each other indicating excellent agreement.\n\nIn Fig. 3, we plot the actual poloidal magnetic field vs an equal arc-length angular variable on the surface $\\widetilde{\\psi}=0.77$ as well as the poloidal magnetic field given by Eq. (37) using the above parameter values. Although not as good as the shape comparison, the agreement is still quite good. One measure of how good it is, is to compare the ideal MHD ballooning mode stability of the numerical data with the parametrized local equilibrium approximation. This is done in the next section.\n\nOf course there are limitations to the shapes which can be described by these parameters. If the plasma shape has a large square component, for example, elongation and trian-\\\\\n\\includegraphics[max width=\\textwidth, center]{2024_11_06_42e8ebfddc819d9dcfb1g-6(1)}\n\nFIG. 3. Comparison of poloidal magnetic field from numerical equilibrium at $\\tilde{\\psi}=0.77$ to the poloidal magnetic field from Eq. (37) using the parameters obtained from numerical equilibrium.\\\\\ngularity will probably not be adequate to describe it. Using the technique described in this section, however, any shape parametrization can be used to generate a local equilibrium mode. In general, if $n$ parameters are required to describe the shape, then $2 n+3$ parameters will be required to specify the equilibrium; $n$ parameters for the shape, $\\partial_{r}$ derivations of the $n$ parameters for $B_{p}$ plus $s, \\alpha$, and $q$.\n\n", "\\section*{V. APPLICATION TO IDEAL MHD BALLOONING MODES}\nWe used the ballooning code BALOO (Ref. 15) to compare the ideal MHD ballooning mode stability of the numerical equilibrium in the last section on flux surface $\\widetilde{\\psi}=0.77$ with the parameterized local equilibrium. BALOO uses the Greene and Chance ${ }^{2}$ technique for varying $s$ and $\\alpha$ on a given flux surface. The results for the marginally stable curve in $s-\\alpha$ space are shown in Fig. 4 and show good agreement as is to be expected from the good agreement in shape and poloidal field.\n\nVarying $s$ and $\\alpha$ are of comparable difficulty using numerical equilibria with Greene and Chance or the local equilibrium model. The real advantage of the local equilibrium model comes when other parameters such as the triangularity are varied as well. Using numerical equilibria, this would require generating a new equilibrium each time the triangularity is changed and as a practical matter many equilibria\\\\\n\\includegraphics[max width=\\textwidth, center]{2024_11_06_42e8ebfddc819d9dcfb1g-6}\n\nFIG. 4. Ballooning mode marginal stability curves in $\\alpha-s$ space for numerical equilibrium at $\\widetilde{\\psi}=0.77$ and local equilibrium parametrization.\\\\\n\\includegraphics[max width=\\textwidth, center]{2024_11_06_42e8ebfddc819d9dcfb1g-7}\n\nFIG. 5. Ballooning mode marginal stability curves in $\\alpha-s$ space for a range of triangularities using local equilibrium parametrization. Based upon numerical equilibrium at $\\tilde{\\psi}=0.77$.\\\\\nwould be required through an iteration process if other parameters such as the elongation of the flux surface were to be held fixed.\n\nTo demonstrate the ease of varying additional parameters using the local equilibrium, the marginal stability curves of the present local equilibrium varying $s, \\alpha$, and $\\delta$ while holding the other six parameters fixed is given in Fig. 5. The figure illustrates the well-known improved access to the second stable region that can be obtained by increasing plasma triangularity. This result, of course, required no additional equilibrium calculations.\n\n\\section*{VI. SUMMARY}\nA generalization of the large aspect ratio shifted circle equilibrium model has been introduced which includes the effects of elongation, triangularity, and finite aspect ratio. Nine parameters are required to fully describe the local equilibrium; $\\kappa, \\delta, A, s_{\\kappa}, s_{\\delta}, \\partial_{r} R_{0}, q, s$, and $\\alpha$. The technique of Sec. IV could be applied to other shape parametrizations. In general, if $n$ shape parameters are introduced including $A$, then $2 n+3$ parameters will be required to specify the local equilibrium.\n\nA comparison of ideal MHD ballooning mode results shows good agreement for a numerical equilibrium vs a local equilibrium generated from the above nine parameters obtained from the numerical equilibrium.\n\nAn initial equilibrium in the neighborhood of a flux surface may be constructed directly from the model or may be obtained from a numerical equilibrium which is then represented locally in terms of the above parameters. In either case, using the model, the above parameters can then be individually varied and when input to stability codes can be used to study the effects of each upon stability.\n\nThis model is particularly suitable for localized stability studies such as those using the ballooning mode representation of the gyrokinetic equations. Many of these gyrofluid ${ }^{16-18}$ and gyrokinetic ${ }^{19,20}$ computer simulations being carried out today use the shifted circle $s-\\alpha$ model. This work allows easy modification of these codes to obtain a more realistic treatment of shape and a means of individually varying shape parameters. The illustration of the model in\\\\\nthe paper was the ideal MHD ballooning mode, this was meant as an illustration of the ease with which individual parameters can be varied using this model.\n\nWhile the best application of this work is probably for realistic shape and controlled shape variation in microstability codes, the illustration of the model in this paper was for ideal MHD ballooning and we believe the model has its uses here as well. For example, data analysis on DIII-D (Ref. 21) often includes a ballooning mode analysis including an assessment of the location of the first and second stability boundaries to ballooning modes. Those stability boundaries are determined by constructing an $s-\\alpha$ diagram starting from the initial numerical equilibrium fit to the data. A new numerical equilibrium is NOT calculated for every new choice of $s$ and $\\alpha$ to map out the boundaries. Because of the work of Greene and Chance, ${ }^{2}$ additional equilibria need not be computed. As described in this paper, this work is, in a sense, an extension of that model and now stability boundaries can be mapped out in elongation or triangularity, for example, without reconstructing a numerical equilibrium for each parameter change as well. A researcher could answer the question of how additional edge triangularity would affect ballooning stability boundaries with a minimum of effort.\n\n\\section*{ACKNOWLEDGMENT}\nThis is a report of work supported by the U.S. Department of Energy under Grant No. DE-FG03-95ER54309.\\\\\n${ }^{1}$ J. W. Connor, R. J. Hastie, and J. B. Taylor, Phys. Rev. Lett. 40, 396 (1978).\\\\\n${ }^{2}$ J. M. Greene and M. S. Chance, Nucl. Fusion 21, 453 (1981).\\\\\n${ }^{3}$ C. Mercier and N. Luc, Report No. EUR-5127e 140 (Commission of the European Communities, Brussels, 1974).\\\\\n${ }^{4}$ C. M. Bishop, P. Kirby, J. W. Connor, R. J. Hastie, and J. B. Taylor, Nucl. Fusion 24, 1579 (1984).\\\\\n${ }^{5}$ C. M. Bishop, Nucl. Fusion 26, 1063 (1986).\\\\\n${ }^{6}$ C. M. Bishop, UKAEA, Culham Laboratory (personal communication, 1985).\\\\\n${ }^{7}$ C. M. Roach, J. W. Connor, and S. Janjua, Plasma Phys. Controlled Fusion 37, 679 (1995).\\\\\n${ }^{8}$ E. Hameiri, Phys. Fluids 26, 230 (1983).\\\\\n${ }^{9}$ R. L. Miller, F. L. Waelbroeck, A. B. Hassam, and R. E. Waltz, Phys. Plasmas 2, 3676 (1995).\\\\\n${ }^{10}$ J. M. Greene, Plasma Phys. Controlled Fusion 30, 327 (1988).\\\\\n${ }^{11}$ R. B. White, Theory of Tokamak Plasmas (North-Holland, Amsterdam, 1989), p. 47.\\\\\n${ }^{12}$ A. M. M. Todd, J. Manickam, M. Okabayashi, M. S. Chance, R. C. Grimm, J. M. Greene, and J. L. Johnson, Nucl. Fusion 19, 743 (1979).\\\\\n${ }^{13}$ M. S. Chu and M. S. Chance, General Atomics (personal communication, 1989). Definitions used in General Atomics version of camino code.\\\\\n${ }^{14}$ L. L. Lao, S. P. Hirshman, and R. M. Wieland, Phys. Fluids 24, 1431 (1981).\\\\\n${ }^{15}$ R. L. Miller, Y. R. Lin-Liu, A. D. Turnbull, V. S. Chan, L. D. Pearlstein, O. Sauter, and L. Villard, Phys. Plasmas 4, 1062 (1997).\\\\\n${ }^{16}$ R. E. Waltz, G. D. Kerbel, J. Milovich, and G. W. Hammett, Phys. Plasmas 2, 2408 (1995).\\\\\n${ }^{17}$ R. E. Waltz, G. M. Staebler, W. Dorland, G. W. Hammett, M. Kotschenreuther, and J. A. Konings, Phys. Plasmas 4, 2482 (1997).\\\\\n${ }^{18}$ M. A. Beer, G. W. Hammett, G. Rewoldt, E. J. Synakowski, M. C. Zarnstorff, and W. Dorland, Phys. Plasmas 4, 1792 (1997).\\\\\n${ }^{19}$ M. Kotschenreuther, G. Rewoldt, and W. M. Tang, Comput. Phys. Commun. 88, 128 (1991).\\\\\n${ }^{20}$ S. E. Parker, H. E. Mynick, M. Artun, J. C. Cummings, V. Decyk, J. F. Kepner, W. W. Lee, and W. M. Tang, Phys. Plasmas 3, 1459 (1996).\\\\\n${ }^{21}$ J. L. Luxon and L. G. Davis, Fusion Technol. 8, 441 (1985).\n\n\n\\end{document}"]}